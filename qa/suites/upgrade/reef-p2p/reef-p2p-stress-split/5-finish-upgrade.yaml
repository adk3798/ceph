tasks:
- cephadm.shell:
  env: [sha1]
  mon.a:
    - ceph orch upgrade start --image quay.ceph.io/ceph-ci/ceph:$sha1
    - while ceph orch upgrade status | jq '.in_progress' | grep true && ! ceph orch upgrade status | jq '.message' | grep Error ; do ceph orch ps ; ceph versions ; ceph orch upgrade status ; ceph health detail ; sleep 30 ; done
    - ceph orch ps
    - ceph versions
    - ceph versions | jq -e '.overall | length == 1'
    - ceph versions | jq -e '.overall | keys' | grep $sha1
- install.upgrade:
    osd.4:
    client.0:
- cephadm.shell:
  mon.a:
    - ceph orch daemon restart osd.4
    - ceph orch daemon restart osd.5
    - ceph orch daemon restart osd.6
    - ceph orch daemon restart osd.7
